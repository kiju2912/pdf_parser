# PDF Document Clustering & Extraction Tool

**Overview:**  
이 프로젝트는 PDF 문서에서 텍스트 블록, 테이블/피규어 캡션 및 비텍스트 요소(이미지, 드로잉 등)를 추출하여 클러스터링 및 병합하는 종합 파이프라인입니다. 최종적으로는 세 가지 주요 산출물을 생성합니다:

- **처리된 PDF**: 캡션과 클러스터 영역이 시각적으로 주석 처리되어, 문서 내에서 어떤 요소가 추출되었는지 한눈에 확인할 수 있습니다.
- **원본 PDF**: 분석 전의 원본 문서로, 처리 전후의 차이를 비교할 수 있습니다.
- **추출된 PDF**: 각 캡션 및 클러스터 영역을 별도의 PDF 파일로 저장하여, 세부 내용을 집중적으로 검토할 수 있습니다.

---

## Pipeline Overview

1. **입력**:  
   - 원본 PDF 파일은 `data/` 디렉터리에 배치됩니다.
2. **텍스트 추출 & 캡션 검출**:  
   - PDF 내 텍스트 블록을 추출하고, 정규 표현식을 사용하여 테이블/피규어 캡션을 식별합니다.
3. **클러스터링 & 영역 병합**:  
   - 이미지 및 드로잉과 같은 비텍스트 요소를 인접도 기반으로 클러스터링하고, 겹치는 영역은 병합합니다.
4. **영역 추출**:  
   - 캡션과 클러스터 영역을 개별 PDF 파일로 저장합니다.
5. **주석 처리 및 시각화**:  
   - 처리된 PDF에 검출된 영역에 대해 경계 상자와 레이블을 삽입해 시각적으로 확인합니다.
6. **데이터베이스 저장**:  
   - 추출된 영역의 좌표, 텍스트 및 기타 메타데이터를 MySQL 데이터베이스에 기록합니다.

---

## Output Elements

### 1. 처리된 PDF  
**설명:**  
처리된 PDF는 캡션 및 클러스터 영역이 색상과 레이블로 주석 처리되어 있습니다. 이 파일을 통해 문서 내 어떤 요소가 검출되고 추출되었는지 한눈에 파악할 수 있습니다.

**예시:**  
![Processed PDF](./clustered/4.pdf)  
*예시: 주석이 추가된 처리된 PDF*

### 2. 원본 PDF  
**설명:**  
원본 PDF는 변경되지 않은 상태의 소스 문서로, 처리 전 문서의 상태를 보여줍니다.

**예시:**  
![Original PDF](./data/4.pdf)  
*예시: 원본 PDF 문서*

### 3. 추출된 PDF  
**설명:**  
개별 캡션이나 클러스터 영역을 별도의 PDF 파일로 저장하여, 세부 내용을 집중적으로 검토할 수 있습니다.

**예시:**  
- **Figure 1 추출:**  
  ![Figure 1](./output/Figure%201_1742225453790903000.pdf)  
  *예시: Figure 1 영역 추출 결과*
- **Figure 2 추출:**  
  ![Figure 2](./output/Figure%202_1742225453785760000.pdf)  
  *예시: Figure 2 영역 추출 결과*
- **Figure 3 추출:**  
  ![Figure 3](./output/Figure%203_1742225453806350000.pdf)  
  *예시: Figure 3 영역 추출 결과*
- **Figure 4 추출:**  
  ![Figure 4](./output/Figure%204_1742225453824121000.pdf)  
  *예시: Figure 4 영역 추출 결과*
- **Figure 5 추출:**  
  ![Figure 5](./output/Figure%205_1742225453827674000.pdf)  
  *예시: Figure 5 영역 추출 결과*

*주의: 위 이미지 경로는 처리 결과가 각각 `clustered/`, `data/`, `output/` 디렉터리에 저장되었음을 전제로 합니다. 실제 경로에 맞게 수정하세요.*

---

## Installation & Setup

1. **필수 라이브러리 설치:**  
   ```bash
   pip install pymupdf mysql-connector-python
   ```

2. **MySQL 데이터베이스 설정:**  
   - `save_to_sql` 함수 내의 MySQL 연결 정보를 실제 환경에 맞게 수정합니다.

3. **디렉터리 구조:**  
   ```
   ├── data/                  # 원본 PDF 파일
   ├── clustered/             # 처리된 PDF (주석 포함)
   ├── output/                # 추출된 개별 PDF 영역
   ├── README.md              # 이 파일
   └── your_script_name.py    # 메인 처리 스크립트
   ```

4. **PDF 파일 배치:**  
   - 분석할 PDF 파일들을 `data/` 폴더에 넣습니다.

5. **프로그램 실행:**  
   ```bash
   python your_script_name.py
   ```

---

## Technical Details

- **텍스트 & 캡션 검출:**  
  - 정규 표현식을 통해 테이블과 피규어 캡션을 식별합니다.
  - 텍스트 블록을 분리하여 주요 콘텐츠와 캡션을 구분합니다.

- **클러스터링 알고리즘:**  
  - 인접한 비텍스트 요소(이미지, 드로잉)를 BFS/DFS 방식으로 클러스터링합니다.
  - 겹치는 영역은 반복적으로 병합하여 최종 클러스터를 생성합니다.

- **영역 추출 및 주석 처리:**  
  - 처리된 PDF에 경계 상자와 텍스트 레이블을 추가해, 각 영역의 역할과 위치를 명확히 합니다.
  - 각 캡션 및 클러스터 영역을 별도의 PDF 파일로 저장합니다.

- **데이터베이스 저장:**  
  - 추출 결과(좌표, 텍스트 등)를 MySQL 데이터베이스에 기록하여, 후속 분석 및 통합이 가능하도록 합니다.

---

## Conclusion

이 도구는 PDF 문서의 복잡한 비 텍스트 레이아웃을 효과적으로 분석하여, 원본 문서와 처리된 결과, 그리고 추출된 영역들을 제공함으로써 사용자가 문서 내 중요한 정보를 한눈에 파악할 수 있도록 도와줍니다. 시각적 주석 처리와 개별 영역 추출 기능을 통해 문서 분석 및 데이터베이스 연동까지 지원하는 올인원 솔루션입니다.

문의 사항이나 기여 제안은 [kiju2912@naver.com]으로 부탁드립니다.
